version: '3.8'

services:
  

  open5gs:
    image: openverso/open5gs:2.7.0
    container_name: open5gs
    ports:
      - "3000:3000"

  mosquitto:
    image: eclipse-mosquitto
    container_name: mosquitto
    ports:
      - "1883:1883"

  mec-stub:
    build: ../mec-stub
    container_name: mec-stub
    depends_on:
      - open5gs
      - mosquitto
    ports:
      - "8080:8080"   # MEC API (e.g. /health, /control)

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    ports:
      - "3001:3000"   # Grafana on http://localhost:3001
    depends_on:
      - prometheus

  suricata:
    image: jasonish/suricata:latest
    container_name: suricata    
    command: -c /etc/suricata/suricata.yaml -i eth0
    network_mode: service:mec-stub
    cap_add:
      - NET_ADMIN
      - NET_RAW
    volumes:
      - ../suricata-rules:/var/lib/suricata/rules
      - suricata-logs:/var/log/suricata
    depends_on:
      - mec-stub

  attacker:
    build: ../attacker-scripts
    container_name: attacker
    tty: true

volumes:
  mongo-data:
  suricata-logs:
